<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
    <title>سیستم برآورد هزینه خدمات سه‌بعدی aesthero studio</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css" rel="stylesheet" type="text/css" />
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;600&display=swap" rel="stylesheet">
    
    <style>
        .logo-font {
            font-family: 'Outfit', sans-serif;
            /* Reduced tracking (was 0.1em, now 0.02em for a tighter, cleaner look) */
            letter-spacing: 0.02em; 
        }
        
        body {
            font-family: 'Vazirmatn', sans-serif;
            background-color: #050505;
            color: #e5e5e5;
            overflow-x: hidden; 
            padding-bottom: 250px; 
        }
        
        /* Input/Select Styling */
        .studio-input, .studio-select {
            background: transparent;
            border: 1px solid #333;
            color: #fff;
            transition: all 0.3s ease;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
        }
        .studio-input:focus, .studio-select:focus { border-color: #fff; outline: none; box-shadow: 0 0 0 1px rgba(255,255,255,0.1); }
        .studio-select option { background-color: #050505; color: #fff; }
        
        /* Card Styling */
        .select-card { border: 1px solid #262626; background: #0a0a0a; transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1); padding-top: 1.25rem; padding-bottom: 1.25rem; }
        .select-card:hover { border-color: #525252; transform: translateY(-2px); }
        .select-card.active { background: #fff; border-color: #fff; color: #000; }
        .select-card.active .sub-text { color: #525252; }
        
        /* Button Styling */
        .btn-primary { background: #fff; color: #000; border: 1px solid #fff; transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1); opacity: 0; visibility: hidden; transform: translateY(10px); }
        .btn-primary:hover { background: transparent; color: #fff; box-shadow: 0 0 20px rgba(255,255,255,0.1); }

        .btn-counter { 
            width: 44px; height: 44px; display: flex; align-items: center; justify-content: center; 
            border: 1px solid #333; border-radius: 4px; cursor: pointer; transition: all 0.2s; font-size: 1.4rem; 
        }
        .btn-counter:hover:not(.disabled) { background: #fff; color: #000; border-color: #fff; }
        .btn-counter.disabled { opacity: 0.2; cursor: not-allowed; border-color: #222; }

        /* Slider Styling */
        .studio-slider { width: 100%; -webkit-appearance: none; appearance: none; height: 10px; background: transparent; margin: 10px 0; cursor: pointer; }
        .studio-slider::-webkit-slider-runnable-track { height: 2px; background: #333; border-radius: 1px; transition: all 0.3s; }
        .studio-slider::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; width: 16px; height: 16px; border-radius: 50%; background: #fff; cursor: pointer; margin-top: -7px; transition: transform 0.2s cubic-bezier(0.16, 1, 0.3, 1); }
        .studio-slider:hover::-webkit-slider-thumb { transform: scale(1.3); }
        
        /* UX Helpers */
        .error-highlight {
            border-color: #f87171 !important; 
            box-shadow: 0 0 10px rgba(248, 113, 113, 0.8);
            animation: pulse-slow 1.5s 2 alternate forwards; 
        }
        @keyframes pulse-slow {
            0% { box-shadow: 0 0 5px rgba(248, 113, 113, 0.5); }
            100% { box-shadow: 0 0 15px rgba(248, 113, 113, 1); }
        }
        
        #validationMessage { opacity: 0; visibility: hidden; transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out; transform: translateY(-20px); }
        #validationMessage.active { opacity: 1; visibility: visible; transform: translateY(0); }
        
        /* Tooltip Styling */
        .tooltip-trigger:hover .tooltip-content {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }
        .tooltip-content {
            opacity: 0;
            visibility: hidden;
            transform: translateY(5px);
            transition: all 0.2s ease-in-out;
        }

        /* Footer Styling */
        .glass-footer {
            background: rgba(5, 5, 5, 0.9);
            backdrop-filter: blur(12px);
            border-top: 1px solid #262626;
            transition: all 0.5s ease-in-out;
            padding-top: 1rem;
            padding-bottom: 1rem;
        }
        .glass-footer.resize { padding-top: 2rem; padding-bottom: 2rem; }
        .glass-footer.resize .btn-primary { opacity: 1; visibility: visible; transform: translateY(0); }
        .glass-footer.resize #totalCostDisplay { font-size: 2.8rem; } 
        .glass-footer.resize .md\:flex > div .text-white { font-size: 0.85rem; }

        /* Landscape Mode */
        @media (orientation: landscape) and (max-width: 1024px) {
            .main-content-wrapper { margin-right: 0; margin-left: 200px; padding-left: 1rem; transition: margin-left 0.5s ease-in-out; }
            .glass-footer {
                top: 0; bottom: 0; right: auto; left: 0; width: 200px; height: 100vh;
                border-top: none; border-right: 1px solid #262626;
                flex-direction: column; justify-content: flex-start; align-items: center;
                padding: 1.5rem 1rem; transition: all 0.5s ease-in-out, width 0.5s ease-in-out;
            }
            .glass-footer.resize { width: 280px; }
            .glass-footer.resize #totalCostDisplay { font-size: 3.8rem; }
            .glass-footer.resize .md\:flex > div .text-white { font-size: 0.85rem; }
            .glass-footer.resize .btn-primary { opacity: 1; visibility: visible; }
            .main-content-wrapper.resize { margin-left: 280px; }
            .glass-footer .md\:hidden { display: none !important; }
            body { padding-bottom: 0 !important; } 
        }
    </style>
</head>
<body>
    <div id="validationMessage" class="fixed top-0 left-0 right-0 bg-red-600 text-white text-center p-3 text-sm z-50">
        برای ارسال درخواست، لطفاً شماره تماس خود را در کادر مربوطه وارد نمایید.
    </div>

    <div class="main-content-wrapper">
        <div class="max-w-4xl mx-auto p-6 md:p-12">
            
            <!-- Header & Logo (Centered, Spaced Out) -->
            <header class="mb-10 border-b border-neutral-800 pb-6 text-center">
                <h1 class="text-3xl md:text-5xl font-normal mb-1 logo-font">
                    <span class="font-semibold text-white">aesthero</span><span class="text-neutral-500 font-light">studio</span>
                </h1>
                <p class="text-neutral-500 text-sm font-light mt-2">سیستم برآورد هزینه خدمات سه‌بعدی</p>
            </header>

            <!-- Section 1: Info -->
            <section class="mb-10 space-y-5">
                <h2 class="text-sm font-medium text-white mb-5 flex items-center gap-3">
                    <span class="w-1 h-4 bg-white block"></span>
                    اطلاعات سفارش‌دهنده
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-5">
                    <div>
                        <label class="block text-sm text-neutral-400 mb-2 uppercase tracking-wider">نام برند</label>
                        <input type="text" id="brandName" class="studio-input w-full p-3 rounded-none text-sm" placeholder="نام برند شما">
                    </div>
                    <div>
                        <label class="block text-sm text-neutral-400 mb-2 uppercase tracking-wider">نام سفارش‌دهنده</label>
                        <input type="text" id="clientName" class="studio-input w-full p-3 rounded-none text-sm" placeholder="آقای/خانم...">
                    </div>
                    <div>
                        <label class="block text-sm text-neutral-400 mb-2 uppercase tracking-wider">شماره تماس (الزامی)</label>
                        <div class="flex gap-2" id="phoneContainer">
                            <input type="tel" id="phoneNumber" class="studio-input w-2/3 p-3 rounded-none text-sm text-left" placeholder="۹۱۲۰۰۰۰۰۰۰">
                            <select id="countryCode" class="studio-select p-3 rounded-none text-sm w-1/3 text-left">
                                <option value="+98" selected>+98 (ایران)</option>
                                <option value="+49">+49 (آلمان)</option>
                                <option value="+374">+374 (ارمنستان)</option>
                                <option value="+964">+964 (عراق)</option>
                                <option value="+90">+90 (ترکیه)</option>
                                <option value="+971">+971 (امارات)</option>
                                <option value="+1">+1 (آمریکا)</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="w-full">
                    <label class="block text-sm text-neutral-400 mb-2 uppercase tracking-wider">نام محصول و توضیحات پروژه</label>
                    <textarea id="productDesc" class="studio-input w-full p-3 rounded-none text-sm h-20" placeholder="شرح مختصری از محصول، نیازها یا مرجع مدل‌سازی..."></textarea>
                </div>
            </section>

            <!-- Section 2: Pricing Configuration -->
            
            <!-- Modeling Level -->
            <section class="mb-10">
                <div class="flex items-center gap-3 mb-5">
                    <h2 class="text-sm font-medium text-white flex items-center gap-3">
                        <span class="w-1 h-4 bg-white block"></span>
                        سطح مدل‌سازی و متریال
                    </h2>
                    <!-- Help Icon with updated text -->
                    <div class="relative tooltip-trigger cursor-help group">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-neutral-500 hover:text-white transition-colors" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        <div class="tooltip-content absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-72 bg-neutral-800 border border-neutral-700 p-3 rounded text-xs text-neutral-300 shadow-xl z-10 pointer-events-none">
                            این بخش مشخص می‌کند محصول شما چقدر پیچیدگی و جزئیات دارد، یا تا چه میزان می‌خواهید جزئیات محصول مدل‌سازی و متریال‌دهی شود.
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="select-card p-5 cursor-pointer" onclick="selectModel(10, this)">
                        <div class="text-lg font-medium mb-1">ساده</div>
                        <div class="sub-text text-neutral-500 text-xs">۱۰ میلیون تومان</div>
                    </div>
                    <div class="select-card p-5 cursor-pointer active" onclick="selectModel(20, this)">
                        <div class="text-lg font-medium mb-1">متوسط</div>
                        <div class="sub-text text-neutral-500 text-xs">۲۰ میلیون تومان</div>
                    </div>
                    <div class="select-card p-5 cursor-pointer" onclick="selectModel(30, this)">
                        <div class="text-lg font-medium mb-1">پیچیده</div>
                        <div class="sub-text text-neutral-500 text-xs">۳۰ میلیون تومان</div>
                    </div>
                </div>
            </section>

            <!-- Frames Slider -->
            <section class="mb-10">
                <div class="flex items-center gap-3 mb-5">
                    <h2 class="text-sm font-medium text-white flex items-center gap-3">
                        <span class="w-1 h-4 bg-white block"></span>
                        تعداد کل فریم‌ها (پایه: ۴.۷ میلیون تومان)
                    </h2>
                    <div class="relative tooltip-trigger cursor-help group">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-neutral-500 hover:text-white transition-colors" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        <div class="tooltip-content absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-64 bg-neutral-800 border border-neutral-700 p-3 rounded text-xs text-neutral-300 shadow-xl z-10 pointer-events-none">
                            تعداد تصاویر نهایی رندر شده از زوایای مختلف محصول که نیاز دارید.
                        </div>
                    </div>
                </div>

                <div class="bg-neutral-900/50 p-6 border border-neutral-800">
                    <div class="flex justify-between items-end mb-5">
                        <span class="text-neutral-400 text-xs">تعداد فریم‌های نهایی درخواستی</span>
                        <span class="text-4xl font-light text-white" id="frameDisplay">۸</span>
                    </div>
                    <input type="range" min="1" max="20" value="8" class="studio-slider mb-4" id="frameSlider" oninput="updateTotalFrames(this.value)">
                    <div class="flex justify-between text-[10px] text-neutral-600 uppercase tracking-widest">
                        <span>۱ فریم</span>
                        <span>۲۰ فریم (حداکثر)</span>
                    </div>
                </div>
            </section>

            <!-- Add-ons Grid -->
            <section class="mb-8">
                <div class="flex items-center gap-3 mb-5">
                    <h2 class="text-sm font-medium text-white flex items-center gap-3">
                        <span class="w-1 h-4 bg-white block"></span>
                        جزئیات سفارش
                    </h2>
                    <div class="relative tooltip-trigger cursor-help group">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-neutral-500 hover:text-white transition-colors" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        <div class="tooltip-content absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-64 bg-neutral-800 border border-neutral-700 p-3 rounded text-xs text-neutral-300 shadow-xl z-10 pointer-events-none">
                            ویژگی‌های خاص برای هر فریم. مثلاً اگر ۳ فریم با کیفیت ۸K می‌خواهید، در بخش رزولوشن عدد ۳ را وارد کنید.
                        </div>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 gap-4">
                    
                    <!-- Composition -->
                    <div class="border border-neutral-800 p-5 flex flex-col sm:flex-row justify-between items-center gap-4 bg-neutral-900/20">
                        <div class="text-center sm:text-left">
                            <div class="text-sm text-white font-medium">چیدمان و ترکیب‌بندی پیچیده</div>
                            <div class="text-xs text-neutral-500 mt-1">اضافه بها برای هر فریم: ۳۰٪</div>
                        </div>
                        <div class="flex flex-col items-center gap-2">
                            <span class="text-xs text-neutral-500 uppercase">تعداد</span>
                            <div class="flex items-center gap-3">
                                <div class="btn-counter" onclick="updateSubCount('comp', -1)">-</div>
                                <span class="w-4 text-center text-sm" id="val-comp">۰</span>
                                <div class="btn-counter" onclick="updateSubCount('comp', 1)">+</div>
                            </div>
                        </div>
                    </div>

                    <!-- Resolution -->
                    <div class="border border-neutral-800 p-5 flex flex-col sm:flex-row justify-between items-center gap-4 bg-neutral-900/20">
                        <div class="text-center sm:text-left">
                            <div class="text-sm text-white font-medium">رزولوشن خروجی بالاتر</div>
                            <div class="text-xs text-neutral-500 mt-1">۴K (+۱۵٪) | ۸K (+۳۰٪)</div>
                        </div>
                        <div class="flex gap-6">
                            <div class="flex flex-col items-center gap-2">
                                <span class="text-xs text-neutral-500 uppercase">تعداد 4K</span>
                                <div class="flex items-center gap-3">
                                    <div class="btn-counter" onclick="updateSubCount('res4k', -1)">-</div>
                                    <span class="w-4 text-center text-sm" id="val-res4k">۰</span>
                                    <div class="btn-counter" onclick="updateSubCount('res4k', 1)">+</div>
                                </div>
                            </div>
                            <div class="flex flex-col items-center gap-2">
                                <span class="text-xs text-neutral-500 uppercase">تعداد 8K</span>
                                <div class="flex items-center gap-3">
                                    <div class="btn-counter" onclick="updateSubCount('res8k', -1)">-</div>
                                    <span class="w-4 text-center text-sm" id="val-res8k">۰</span>
                                    <div class="btn-counter" onclick="updateSubCount('res8k', 1)">+</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- FX -->
                    <div class="border border-neutral-800 p-5 flex flex-col sm:flex-row justify-between items-center gap-4 bg-neutral-900/20">
                        <div class="text-center sm:text-left">
                            <div class="text-sm text-white font-medium">شبیه‌سازی و جلوه‌های ویژه</div>
                            <div class="text-xs text-neutral-500 mt-1">سبک (+۳۰٪) | سنگین (+۶۰٪)</div>
                        </div>
                        <div class="flex gap-6">
                            <div class="flex flex-col items-center gap-2">
                                <span class="text-xs text-neutral-500 uppercase">تعداد FX سبک</span>
                                <div class="flex items-center gap-3">
                                    <div class="btn-counter" onclick="updateSubCount('fxLight', -1)">-</div>
                                    <span class="w-4 text-center text-sm" id="val-fxLight">۰</span>
                                    <div class="btn-counter" onclick="updateSubCount('fxLight', 1)">+</div>
                                </div>
                            </div>
                            <div class="flex flex-col items-center gap-2">
                                <span class="text-xs text-neutral-500 uppercase">تعداد FX سنگین</span>
                                <div class="flex items-center gap-3">
                                    <div class="btn-counter" onclick="updateSubCount('fxHeavy', -1)">-</div>
                                    <span class="w-4 text-center text-sm" id="val-fxHeavy">۰</span>
                                    <div class="btn-counter" onclick="updateSubCount('fxHeavy', 1)">+</div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </section>
        </div>
    </div>
    
    <!-- Sticky Footer with increased gap-8 -->
    <div class="fixed bottom-0 left-0 right-0 glass-footer z-50 p-4 md:p-6" id="sticky-footer">
        <div class="max-w-4xl mx-auto flex justify-between items-center transition-all duration-500 ease-in-out gap-8">
            
            <!-- Price Block -->
            <div class="flex-grow">
                <div class="text-xs text-neutral-500 uppercase tracking-widest mb-1">مبلغ کل برآورد (تومان)</div>
                <div class="text-3xl md:text-4xl font-light text-white tracking-tight leading-tight transition-all duration-500 ease-in-out" id="totalCostDisplay">۵۷,۶۰۰,۰۰۰</div>
            </div>

            <!-- Payment Schedule -->
            <div class="hidden md:flex gap-8 text-xs text-neutral-400 border-r border-neutral-800 pr-8">
                <div>
                    <div class="text-neutral-600 mb-1">مرحله ۱ (۳۳٪)</div>
                    <div class="text-white transition-all duration-500 ease-in-out" id="pay-1">۰</div>
                </div>
                <div>
                    <div class="text-neutral-600 mb-1">مرحله ۲ (۳۳٪)</div>
                    <div class="text-white transition-all duration-500 ease-in-out" id="pay-2">۰</div>
                </div>
                <div>
                    <div class="text-neutral-600 mb-1">مرحله ۳ (۳۴٪)</div>
                    <div class="text-white transition-all duration-500 ease-in-out" id="pay-3">۰</div>
                </div>
            </div>

            <!-- Action Button: Removed ml-4 to rely on gap-8 -->
            <button onclick="sendRequest()" id="send-request-button" class="w-auto px-8 min-w-[140px] btn-primary py-3 rounded text-sm font-medium tracking-wide">
                ارسال درخواست
            </button>
        </div>

        <!-- Mobile Payment Schedule -->
        <div class="md:hidden mt-4 pt-4 border-t border-neutral-800 grid grid-cols-3 gap-2 text-xs">
            <div>
                <span class="text-neutral-500 block">مرحله ۱ (۳۳٪)</span>
                <span class="text-white" id="pay-1-m">۰</span>
            </div>
            <div>
                <span class="text-neutral-500 block">مرحله ۲ (۳۳٪)</span>
                <span class="text-white" id="pay-2-m">۰</span>
            </div>
            <div>
                <span class="text-neutral-500 block">مرحله ۳ (۳۴٪)</span>
                <span class="text-white" id="pay-3-m">۰</span>
            </div>
        </div>
    </div>

    <script>
        // --- Constants & State ---
        const BASE_FRAME_PRICE = 4700000;
        const TARGET_EMAIL = "mehrdad.shiran@gmail.com";
        
        let state = {
            modelingPrice: 20000000,
            modelingLabel: "متوسط",
            totalFrames: 8,
            counts: { res4k: 0, res8k: 0, comp: 0, fxLight: 0, fxHeavy: 0 }
        };

        // --- Utils ---
        const toPersianDigits = (n) => {
            const farsiDigits = ['۰', '۱', '۲', '۳', '۴', '۵', '۶', '۷', '۸', '۹'];
            return n.toString().replace(/\d/g, x => farsiDigits[x]);
        };

        const formatMoneyFull = (n) => toPersianDigits(new Intl.NumberFormat('en-US').format(Math.round(n))) + ' تومان';
        const formatMoneyShort = (n) => toPersianDigits(new Intl.NumberFormat('en-US').format(Math.round(n))); 
        const getEl = (id) => document.getElementById(id);

        // --- Core Logic ---
        
        function selectModel(priceInMillions, element) {
            state.modelingPrice = priceInMillions * 1000000;
            state.modelingLabel = priceInMillions === 10 ? "ساده" : (priceInMillions === 20 ? "متوسط" : "پیچیده");
            
            document.querySelectorAll('.select-card').forEach(el => el.classList.remove('active'));
            element.classList.add('active');
            calculate();
        }

        function updateTotalFrames(val) {
            const newVal = parseInt(val);
            state.totalFrames = newVal;
            getEl('frameDisplay').innerText = toPersianDigits(newVal);
            validateCounts();
            calculate();
        }

        function updateSubCount(type, change) {
            const currentVal = state.counts[type];
            const newVal = currentVal + change;
            if (newVal < 0) return;

            // Composition Check (Cannot exceed totalFrames)
            if (type === 'comp' && newVal > state.totalFrames) return;

            // Resolution Check (res4k + res8k <= totalFrames)
            if ((type === 'res4k' || type === 'res8k') && (newVal + (type === 'res4k' ? state.counts.res8k : state.counts.res4k) > state.totalFrames)) return;

            // FX Check (fxLight + fxHeavy <= totalFrames)
            if ((type === 'fxLight' || type === 'fxHeavy') && (newVal + (type === 'fxLight' ? state.counts.fxHeavy : state.counts.fxLight) > state.totalFrames)) return;

            state.counts[type] = newVal;
            getEl(`val-${type}`).innerText = toPersianDigits(newVal);
            calculate();
        }

        function validateCounts() {
            const { totalFrames, counts } = state;
            
            if (counts.comp > totalFrames) { state.counts.comp = totalFrames; }
            
            if (counts.res4k + counts.res8k > totalFrames) {
                state.counts.res8k = Math.max(0, totalFrames - counts.res4k);
                if (state.counts.res8k === 0 && counts.res4k > totalFrames) state.counts.res4k = totalFrames;
            }

            if (counts.fxLight + counts.fxHeavy > totalFrames) {
                state.counts.fxHeavy = Math.max(0, totalFrames - counts.fxLight);
                if (state.counts.fxHeavy === 0 && counts.fxLight > totalFrames) state.counts.fxLight = totalFrames;
            }

            for (let key in state.counts) {
                getEl(`val-${key}`).innerText = toPersianDigits(state.counts[key]);
            }
            
            // Ensure slider position is correct
            getEl('frameSlider').value = totalFrames;
        }
        
        function calculate() {
            validateCounts();

            // 1. Base Costs
            const baseRenderCost = state.totalFrames * BASE_FRAME_PRICE;
            
            // 2. Extra Costs 
            const cost4k = state.counts.res4k * (BASE_FRAME_PRICE * 0.15);
            const cost8k = state.counts.res8k * (BASE_FRAME_PRICE * 0.30);
            const costComp = state.counts.comp * (BASE_FRAME_PRICE * 0.30);
            const costFxL = state.counts.fxLight * (BASE_FRAME_PRICE * 0.30);
            const costFxH = state.counts.fxHeavy * (BASE_FRAME_PRICE * 0.60);

            const totalSurcharges = cost4k + cost8k + costComp + costFxL + costFxH;
            const grandTotal = state.modelingPrice + baseRenderCost + totalSurcharges;

            // Payment Stages
            const pay1 = grandTotal * 0.33;
            const pay2 = grandTotal * 0.33;
            const pay3 = grandTotal * 0.34;

            // Update UI with Persian Digits
            getEl('totalCostDisplay').innerText = formatMoneyShort(grandTotal);
            getEl('pay-1').innerText = formatMoneyFull(pay1);
            getEl('pay-2').innerText = formatMoneyFull(pay2);
            getEl('pay-3').innerText = formatMoneyFull(pay3);
            getEl('pay-1-m').innerText = formatMoneyFull(pay1);
            getEl('pay-2-m').innerText = formatMoneyFull(pay2);
            getEl('pay-3-m').innerText = formatMoneyFull(pay3);

            return { grandTotal, baseRenderCost, cost4k, cost8k, costComp, costFxL, costFxH, pay1, pay2, pay3 };
        }

        // --- Validation UX Function ---

        function showValidationFeedback() {
            const phoneInput = getEl('phoneNumber');
            const validationMsg = getEl('validationMessage');
            
            // 1. Show the floating message
            validationMsg.classList.add('active');
            
            // 2. Scroll to the element smoothly
            phoneInput.scrollIntoView({ behavior: 'smooth', block: 'center' });

            // 3. Apply the highlight/glow effect
            phoneInput.classList.add('error-highlight');
            
            // 4. Remove all visual cues after 3 seconds
            setTimeout(() => {
                phoneInput.classList.remove('error-highlight');
                validationMsg.classList.remove('active');
            }, 3000); 
        }

        // --- Request Submission (Mailto) ---

        function sendRequest() {
            const phoneNumber = getEl('phoneNumber').value.trim();
            
            if (!phoneNumber) {
                showValidationFeedback();
                return;
            }

            const data = calculate();
            const date = new Date().toLocaleDateString('fa-IR');
            
            // Collect all client data
            const brandName = getEl('brandName').value || "وارد نشده";
            const clientName = getEl('clientName').value || "وارد نشده";
            const phoneCode = getEl('countryCode').value;
            const fullPhone = phoneNumber ? `${phoneCode} ${phoneNumber}` : "وارد نشده";
            const projectDesc = getEl('productDesc').value || "وارد نشده";

            const subject = `درخواست برآورد هزینه از ${brandName} - ${clientName}`;

            // Build detailed text body
            const emailBody = `
**درخواست جدید برآورد هزینه از استودیو aesthero**

**تاریخ:** ${date}

--- اطلاعات سفارش‌دهنده ---
* **نام برند:** ${brandName}
* **نام سفارش‌دهنده:** ${clientName}
* **شماره تماس:** ${fullPhone}
* **نام محصول و توضیحات پروژه:**
${projectDesc}

--- خلاصه هزینه (مبلغ کل: ${formatMoneyFull(data.grandTotal)}) ---
* **سطح مدل‌سازی:** ${state.modelingLabel} (${formatMoneyFull(state.modelingPrice)})
* **تعداد کل فریم (پایه):** ${state.totalFrames} فریم (${formatMoneyFull(data.baseRenderCost)})

--- جزئیات سفارش ---
* **چیدمان پیچیده (+۳۰٪):** ${toPersianDigits(state.counts.comp)} فریم (اضافه بها: ${formatMoneyFull(data.costComp)})
* **رزولوشن 4K (+۱۵٪):** ${toPersianDigits(state.counts.res4k)} فریم (اضافه بها: ${formatMoneyFull(data.cost4k)})
* **رزولوشن 8K (+۳۰٪):** ${toPersianDigits(state.counts.res8k)} فریم (اضافه بها: ${formatMoneyShort(data.cost8k)})
* **FX سبک (+۳۰٪):** ${toPersianDigits(state.counts.fxLight)} فریم (اضافه بها: ${formatMoneyFull(data.costFxL)})
* **FX سنگین (+۶۰٪):** ${toPersianDigits(state.counts.fxHeavy)} فریم (اضافه بها: ${formatMoneyFull(data.costFxH)})

--- شرایط پرداخت (تومان) ---
* **مرحله اول (۳۳٪):** ${formatMoneyShort(data.pay1)}
* **مرحله دوم (۳۳٪):** ${formatMoneyShort(data.pay2)}
* **مرحله سوم (۳۴٪):** ${formatMoneyShort(data.pay3)}

لطفا این اطلاعات را بررسی کرده و برای تأیید ارسال نمایید.
`;
            
            const encodedBody = encodeURIComponent(emailBody);
            const encodedSubject = encodeURIComponent(subject);

            const mailtoLink = `mailto:${TARGET_EMAIL}?subject=${encodedSubject}&body=${encodedBody}`;

            window.open(mailtoLink, '_blank');
        }


        // --- Scroll Animation Logic ---
        function handleScroll() {
            const footer = getEl('sticky-footer');
            const mainContentWrapper = document.querySelector('.main-content-wrapper');
            
            const isLandscape = window.innerWidth < 1024 && window.matchMedia("(orientation: landscape)").matches;
            
            let scrollThreshold;
            
            if (isLandscape) {
                // Determine when to expand the vertical footer
                scrollThreshold = mainContentWrapper.scrollHeight - mainContentWrapper.clientHeight - 100;
                
                if (window.scrollY >= scrollThreshold) {
                    footer.classList.add('resize');
                    mainContentWrapper.classList.add('resize');
                } else {
                    footer.classList.remove('resize');
                    mainContentWrapper.classList.remove('resize');
                }
            } else {
                // Determine when to expand the horizontal footer
                scrollThreshold = document.body.scrollHeight - window.innerHeight - 200; 
                
                if (window.scrollY >= scrollThreshold) {
                    footer.classList.add('resize');
                } else {
                    footer.classList.remove('resize');
                }
                mainContentWrapper.classList.remove('resize'); 
            }
        }

        // --- Init ---
        window.addEventListener('scroll', handleScroll);
        window.addEventListener('resize', handleScroll); 
        window.addEventListener('load', () => {
             // Set initial values and styles
             selectModel(20, document.querySelector('.select-card:nth-child(2)'));
             calculate();
             handleScroll(); 
        });

    </script>
</body>
</html>
